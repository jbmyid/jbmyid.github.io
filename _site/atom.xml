<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

 <title>jbmyid</title>
 <link href="http://www.jbmyid.in/atom.xml" rel="self"/>
 <link href="http://www.jbmyid.in/"/>
 <updated>2014-04-04T18:43:54+05:30</updated>
 <id>http://www.jbmyid.in</id>
 <author>
   <name>Jalendra Bhanarkar</name>
   <email></email>
 </author>

 
 <entry>
   <title>Generate PDF(e-ticket) from html in Rails</title>
   <link href="http://www.jbmyid.in/blog/html-to-pdf"/>
   <updated>2014-04-04T00:00:00+05:30</updated>
   <id>http://www.jbmyid.in/blog/html-to-pdf</id>
   <content type="html">&lt;h1 id=&quot;pdfe-ticket-from-html-in-rails&quot;&gt;PDF(e-ticket) from html in Rails&lt;/h1&gt;

&lt;p&gt;Following are the steps for creating pdf from html views.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Add gem “pdfkit” in gemfile&lt;/li&gt;
  &lt;li&gt;Download following 2 files
    &lt;ul&gt;
      &lt;li&gt;wkhtmltopdf-amd64 from &lt;a href=&quot;http://code.google.com/p/wkhtmltopdf/downloads/detail?name=wkhtmltopdf-0.9.9-static-amd64.tar.bz2&amp;amp;can=2&amp;amp;q=&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;wkhtmltopdf-i386 from &lt;a href=&quot;http://code.google.com/p/wkhtmltopdf/downloads/detail?name=wkhtmltopdf-0.9.9-static-i386.tar.bz2&amp;amp;can=2&amp;amp;q=&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Create “bin” folder in your rails application folder and extract above files in this “bin” folder. These are the binaries which are needed for creating  pdf from html views.&lt;/li&gt;
  &lt;li&gt;Create “pdfkit.rb” in “config/initializers” folder of the application. And add following code&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;
&lt;code class=&quot;ruby&quot;&gt;
  #pdfkit.rb
  PDFKit.configure do |config|
    if [&quot;development&quot;].include?(Rails.env)
      #only if your are working on 32bit machine
      config.wkhtmltopdf = Rails.root.join(&#39;bin&#39;, &#39;wkhtmltopdf-i386&#39;).to_s
    else
      #if your site is hosted on heroku or any other hosting server which is 64bit
      config.wkhtmltopdf = Rails.root.join(&#39;bin&#39;, &#39;wkhtmltopdf-amd64&#39;).to_s
    end
    config.default_options = {
      :encoding=&amp;gt;&quot;UTF-8&quot;,
      :page_size=&amp;gt;&quot;A4&quot;,
      :margin_top=&amp;gt;&quot;0.25in&quot;,
      :margin_right=&amp;gt;&quot;0.1in&quot;,
      :margin_bottom=&amp;gt;&quot;0.25in&quot;,
      :margin_left=&amp;gt;&quot;0.1in&quot;,
      :disable_smart_shrinking=&amp;gt; false
    }
  end
  &lt;/code&gt;
&lt;/pre&gt;
&lt;ul&gt;
  &lt;li&gt;Create a file e_ticket.rb in models folder as following&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;
  &lt;code class=&quot;ruby&quot;&gt;
    # e-ticket
    class ETicket &amp;lt; AbstractController::Base
      include AbstractController::Rendering
      include AbstractController::Helpers
      include AbstractController::Translation
      include AbstractController::AssetPaths
      include Rails.application.routes.url_helpers
      helper ApplicationHelper
      self.view_paths = &quot;app/views&quot;
      attr_reader :html
      def initialize(order)
        @order = order
        @html = render_to_string(partial: &quot;shared/e_ticket&quot;, :layout =&amp;gt; false,
             :disposition =&amp;gt; &#39;inline&#39;)
      end
      def pdf
        kit = PDFKit.new(@html)
        kit.stylesheets &amp;lt;&amp;lt; &quot;#{Rails.root}/app/assets/stylesheets/pdf.css&quot;
        kit.to_pdf
      end
    end
  &lt;/code&gt;
&lt;/pre&gt;

&lt;p&gt;In above code, we have added style sheet “pdf.css” in which we have to write the pdf related css rules. Keep this file as separate for pdf only .
Now you have your e-ticket ready to download and attach to any mail. You have to just create e-ticket by&lt;/p&gt;
&lt;pre&gt;
  &lt;code class=&quot;ruby&quot;&gt;
    eticket = ETicket.new(order)
    pdf = eticket.pdf
  &lt;/code&gt;
&lt;/pre&gt;

&lt;p&gt;Yehhhhhh……………..its ready to download and attach.&lt;/p&gt;

&lt;p&gt;Now I am writing brief for downloading and attaching the pdf to mail.&lt;/p&gt;

&lt;h3 id=&quot;how-to-download-eticket-pdf&quot;&gt;How to download eticket pdf.&lt;/h3&gt;
&lt;p&gt;In your orders controller you can create an separate action for downloading or you can do this in your orders show action in pdf response. Any way I am creating separate action for downloading order’s e-ticket pdf.&lt;/p&gt;
&lt;pre&gt;
  &lt;code class=&quot;ruby&quot;&gt;
    class OrdersController &amp;lt; ApplicationController
      def download
        @order = Order.find(params[:id])
        eticket = ETicket.new(@order)
        send_data(eticket.pdf, :filename =&amp;gt; &quot;e-Ticket #{@order.number}&quot;,
           :type =&amp;gt; &#39;application/pdf&#39;)
      end
    end
  &lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;###Sending e-ticket as attachment in mail&lt;/p&gt;
&lt;pre&gt;
  &lt;code class=&quot;ruby&quot;&gt;
    class OrderMailer &amp;lt; ActionMailer::Base
      def send_e_ticket(order)
        @order = order
        subject = &quot; E-Ticket&quot;
        eticket = ETicket.new(@order)
        attachments[&quot;E-Ticket #{@order.number}.pdf&quot;] = eticket.pdf
        mail(:to =&amp;gt;”abc@gmail.com”, :subject =&amp;gt;”E-ticket”)
      end
    end
  &lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Now send an mail using following code&lt;/p&gt;
&lt;pre&gt;
  &lt;code class=&quot;ruby&quot;&gt;
    OrderMailer.send_e_ticket(order).deliver
  &lt;/code&gt;
&lt;/pre&gt;

&lt;p&gt;yippeeeeee…..Mail sent with attached e-ticket pdf.&lt;/p&gt;

&lt;h1 id=&quot;thank-you&quot;&gt;THANK YOU&lt;/h1&gt;
</content>
 </entry>
 

</feed>
